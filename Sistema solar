#include <iostream>
#include <fstream>
#include <ctime>
#include <cmath>
#include <math.h>
using namespace std;
int main ()
{

    //Tomamos vectores para resolver el problema. El primer término identifica el planeta que es
    //mientras que el segundo guarda si estamos en la componente "x" o "y"
    double v[20][2],r[22][2],a[22][2],ah[22][2],w[22][2],rinicial[22][2], Posrelativa[22][2];
    double m[22],Ec[22],Ep[22],Em[22], tiemporeal,tiempoendias[22], aux[22],aux2[22],r1[22],r2[22],r3[22], contador[22],periodopromedio[22];
    double vel,d,p,t,h,Et;
    int i,j,k,q,s,n,l;
    h=0.01;

    for(i=1;i<=11;i++)
    {
        tiempoendias[i]=0.0;
    }

    for(i=1;i<=11;i++)
    {
        contador[i]=0;
    }

    //Inicializamos todo teniendo en cuenta que si el segundo termino del vector es 0
    //estamos en el eje x y si es 1 en el y
    //El primer termino nos habla de que planeta estamos analizando

    ifstream ficheror, ficherov, ficherom;
    ofstream pos, Energia,periodos, posicionesrelativas;

    //Abrimos los archivos con los datos que vamos anecesitar

    pos.open("posiciones.txt",ios::out);
    Energia.open("Energia.txt",ios::out);
    periodos.open("periodos.txt",ios::out);
    posicionesrelativas.open("Posicionesrelativas.txt",ios::out);
    ficherov.open("velocidad.txt");

    i=0;

    //Inicializamos la velocidad
    while(!ficherov.eof())
    {
        ficherov>>vel;
        v[i][1]=-vel;
        v[i][0]=0.0;
        i++;
    }
    ficherov.close();

    //Inicializamos la posicion
    ficheror.open("distancias.txt");
    i=0;
    while(!ficheror.eof())
    {
        ficheror>>d;
        r[i][0]=d;
        r[i][1]=0.0;
        rinicial[i][0]=r[i][0];
        rinicial[i][1]=r[i][1];
        i++;
    }
    ficheror.close ();

    //Inicializamos las masas
    ficherom.open ("masas.txt");
    i=0;
    while(!ficherom.eof())
    {
        ficherom>>p;
        m[i]=p;
        i++;
    }
    ficheror.close ();
    i=0;
    n=0;

    //Ejecutamos el algoritmo principal
    for(t=0.0;t<=600.0;t=t+h)
    {
        n++;
        for(i=0;i<=10;i++)
        {
            //Este bucle se usa para ir recorriendo cada planeta

            for(j=0;j<=1;j++)
            {
                //Este  bucle recorre la componente "x" y la componente "y" de cada planeta

                a[i][j]=0.0;
                ah[i][j]=0.0;

                for(k=0;k<=10;k++)
                {
                    //La aceleración es la suma de las aceleraciones que le produce cada planeta que no sea el mismo1

                    if(k!=i)
                    {

                        a[i][j]=a[i][j]+m[k]*(r[i][j]-r[k][j])/(abs(pow((r[k][0]-r[i][0])*(r[k][0]-r[i][0])+(r[k][1]-r[i][1])*(r[k][1]-r[i][1]),1.5)))*(-1.0);
                    }

                }
                w[i][j]=v[i][j]+h/2.0*a[i][j];
                r[i][j]=r[i][j]+h*w[i][j];

                for(k=0;k<=10;k++)
                {
                    if(k!=i)
                    {
                        ah[i][j]=ah[i][j]+m[k]*(r[i][j]-r[k][j])/(abs(pow((r[k][0]-r[i][0])*(r[k][0]-r[i][0])+(r[k][1]-r[i][1])*(r[k][1]-r[i][1]),1.5)))*(-1.0);
                    }
                }
                v[i][j]=w[i][j]+(h/2.0)*(ah[i][j]);

            }

            //Metemos las posiciones de los planetas que nos interesan en un fichero
            //Podemos quitar algunos datos para no petar mucho el fichero


            if(n%1000==0)
            {
                //La posicion relativa es restar la posicion de cada planeta con la de la tierra

                for(l=0;l<=10;l++)
                {
                    //Posrelativa[l][0]=r[l][0]-r[3][0];
                    //Posrelativa[l][1]=r[l][1]-r[3][1];

                    pos<<r[l][0] <<", "<<r[l][1]<<endl;
                    posicionesrelativas<<r[l][0]-r[3][0] <<", "<<r[l][1]-r[3][1]<<endl;
                }
             pos<<endl;
             posicionesrelativas<<endl;

            }

            Et=0;
            for(q=0;q<=10;q++)
            {
                Ep[q]=0;
                Ec[q]=1.0/2.0*m[q]*(v[q][0]*v[q][0]+v[q][1]*v[q][1]);

                for(s=0;s<=10;s++)
                {
                    if(s!=q)
                    {
                            Ep[q]=Ep[q]-m[q]*m[s]*m[q]/sqrt((r[s][0]-r[q][0])*(r[s][0]-r[q][0])+(r[s][1]-r[q][1])*(r[s][1]-r[q][1]));
                    }

                }

                Em[q]=Ec[q]+Ep[q];
                Et=Et+Em[q];
            }

            Energia<<Et<<endl;
            //Orbitas
            //modificar inicial
            //Periodos
            //Energia

        }
        //Para calcular el periodo cogemos tres puntos
        // consecutivos y comprobamos si uno de ellos es maximo en el eje x
        //Si es maximo justo en ese momento se completa el periodo

        for(i=1;i<=11;i++)
        {
            r3[i]=r2[i];
            r2[i]=r1[i];
            r1[i]=r[i][0];
        }



        for(i=1;i<=11;i++)
        {

            if(r2[i]>r3[i] & r2[i]>r1[i] & n>3)
            {

                tiemporeal=(t-h)*pow(sqrt(6.67*1.99/(1.496*1.496*1.496)*pow(10,-14)),-1);
                tiempoendias[i]=tiemporeal/(3600.0*24.0);
                contador[i]++;
            }
        }


    }
            for(i=1;i<=11;i++)
        {
            periodopromedio[i]=tiempoendias[i]/contador[i];
            periodos<<"El periodo del planeta "<<i<<" es "<<periodopromedio[i]<<" dias"<<endl;
        }

  periodos.close();
  pos.close();
  Energia.close();
  posicionesrelativas.close();



return 0;
}
